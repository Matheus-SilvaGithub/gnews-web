<h2>ğŸ“° NotÃ­cias</h2>

<div class="controls">

  <input
    type="text"
    placeholder="Pesquisar notÃ­cias"
    [(ngModel)]="searchTerm"
    (keyup.enter)="search()"
    [disabled]="loading || loadingMore"
  />

  <button
    (click)="search()"
    [disabled]="loading || loadingMore || !searchTerm.trim()">
    Buscar
  </button>

  @if (isSearchMode) {
    <button
      (click)="clearSearch()"
      [disabled]="loading || loadingMore">
      Limpar
    </button>
  }

  <select
    [(ngModel)]="category"
    (change)="loadNews(true)"
    [disabled]="isSearchMode || loading || loadingMore">

    <option value="general">Geral</option>
    <option value="technology">Tecnologia</option>
    <option value="business">NegÃ³cios</option>
    <option value="sports">Esportes</option>
    <option value="entertainment">Entretenimento</option>
    <option value="health">SaÃºde</option>
    <option value="science">CiÃªncia</option>
  </select>

</div>

<!-- Skeleton loader -->
@if (loading) {
  <div class="grid">
    @for (s of skeletons; track $index) {
      <div class="card skeleton">
        <div class="img"></div>
        <div class="line title"></div>
        <div class="line"></div>
        <div class="line short"></div>
      </div>
    }
  </div>
}

@if (error) {
  <p class="status error">âŒ Erro ao carregar notÃ­cias</p>
}

@if (!loading && !error && articles.length === 0) {
  <p class="status empty">âš ï¸ Nenhuma notÃ­cia encontrada</p>
}

<div class="grid">
  @for (article of articles; track article.id; let i = $index) {
    <article class="card" [class.featured]="i === 0 && page === 1">

      @if (article.image) {
        <img
          [src]="article.image"
          [alt]="article.title"
          loading="lazy"
        />
      }

      <h3>{{ article.title }}</h3>

      <small>
        {{ article.publishedAt | date:'dd/MM/yyyy HH:mm' }}
      </small>

      <p>{{ article.description }}</p>

      <a [href]="article.url" target="_blank" rel="noopener">
        Ler mais â†’
      </a>

    </article>
  }
</div>

@if (loadingMore) {
  <p class="status loading-more">â¬‡ï¸ Carregando mais notÃ­cias...</p>
}

@if (!loading && !loadingMore && page >= totalPages && articles.length > 0) {
  <p class="status end">ğŸ›‘ VocÃª chegou ao fim das notÃ­cias</p>
}

<div #anchor></div>
